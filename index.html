if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
  .then(reg => console.log('Service Worker registriert'))
  .catch(err => console.log('Service Worker Fehler:', err));
}

const startBtn = document.getElementById('start');
const intervalSelect = document.getElementById('interval');

startBtn.addEventListener('click', async () => {
  // Notification-Berechtigung prüfen
  if (Notification.permission !== 'granted') {
    const permission = await Notification.requestPermission();
    if (permission !== 'granted') {
      alert('Benachrichtigungen müssen erlaubt werden, damit die Trink-Erinnerung funktioniert.');
      return;
    }
  }

  // Service Worker bereit
  const registration = await navigator.serviceWorker.ready;

  // Interval an Service Worker senden
  if (registration.active) {
    registration.active.postMessage({
      type: 'SET_INTERVAL',
      interval: intervalSelect.value
    });
    alert(`Trink-Erinnerungen gestartet: alle ${intervalSelect.value} Minuten zwischen 08:00–21:00`);
  } else {
    alert('Service Worker noch nicht bereit. Seite bitte neu laden.');
  }
});
